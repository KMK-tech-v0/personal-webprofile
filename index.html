<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kaung Myat Kyaw — Data Analyst Portfolio (Fixed)</title>

<!-- Inter font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2pdf for resume download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<!-- Mermaid.js for workflow diagrams -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

<style>
  :root{
    --bg:#071024;
    --card:#0f1724;
    --muted:#9aa6b2;
    --accent-1:#38bdf8; /* cyan */
    --accent-2:#6366f1; /* indigo */
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --glass-2: rgba(255,255,255,0.02);
  }

  /* animated accent variables (will be animated) */
  html{ --a1: var(--accent-1); --a2: var(--accent-2); }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,#061223 0%, #071428 100%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }

  /* Background layers: video + overlay + optional canvases (fallback) */
  #bgCanvas, #waveCanvas, #bgVideo, #bgOverlay {
    position:fixed;
    inset:0;
    z-index:0;
    pointer-events:none;
  }
  #bgVideo { width:100%; height:100%; object-fit:cover; display:none; }
  #bgOverlay { background:linear-gradient(180deg, rgba(6,18,35,0.55), rgba(3,9,18,0.75)); }

  .container{
    position:relative;
    z-index:1;
    max-width:1200px;
    width:100%;
    margin:36px auto;
    padding:20px;
  }

  header{
    display:flex;
    gap:18px;
    align-items:center;
    justify-content:space-between;
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.006));
    padding:18px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,0.03);
    backdrop-filter: blur(6px);
    box-shadow: 0 6px 30px rgba(1,6,24,0.6);
    transition:transform .22s ease, box-shadow .22s ease;
  }
  header:hover{ transform: translateY(-2px); }

  .left {
    display:flex;
    gap:18px; /* align some extra space for larger photo */
    align-items:center;
  }
  .avatar {
    width:120px;   /* slightly larger profile photo */
    height:120px;  /* slightly larger profile photo */
    border-radius:14px;
    background:linear-gradient(135deg,var(--a1),var(--a2));
    display:grid;
    place-items:center;
    overflow:hidden; /* ensure image crops nicely */
    box-shadow:0 8px 30px rgba(56,189,248,0.08), inset 0 -8px 20px rgba(0,0,0,0.2);
  }
  .avatar img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:inherit; }

  h1{margin:0;font-size:1.4rem}
  p.role{margin:0;color:var(--muted);font-weight:600}
  .contacts{color:var(--muted);font-size:0.9rem;margin-top:8px}

  .actions{display:flex;gap:10px;align-items:center;}
  .btn{
    background:linear-gradient(90deg,var(--a1),var(--a2));
    color:#042033;
    padding:10px 14px;
    border-radius:10px;
    font-weight:700;
    border:none;
    cursor:pointer;
    box-shadow:0 8px 30px rgba(56,189,248,0.06);
    display:inline-flex;align-items:center;gap:8px;
  }
  .btn.secondary{
    background:transparent;
    color:var(--a1);
    border:1px solid rgba(255,255,255,0.06);
    box-shadow:none;
  }
  .btn.ghost{ background:transparent; color:var(--muted); border:none; box-shadow:none; padding:8px; }

  .grid{
    display:grid;
    grid-template-columns: 380px 1fr;
    gap:22px;
    margin-top:20px;
  }
  @media (max-width:980px){
    .grid{grid-template-columns:1fr; padding-bottom:30px}
    .left h1{font-size:1.12rem}
    .actions{ width:100%; }
  }

  .sidebar{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    padding:18px;
    border-radius:var(--radius);
    border:1px solid rgba(255,255,255,0.03);
  }
  .block{margin-bottom:20px}
  .block h3{margin:0 0 10px 0;font-size:1.05rem;color:var(--a1)}
  .muted{color:var(--muted);font-size:0.95rem}

  /* Skills */
  .skill{margin:10px 0; opacity:0; transform:translateY(8px); transition:opacity .6s ease, transform .6s ease;}
  .skill.visible{opacity:1; transform:none;}
  .skill .meta{display:flex;justify-content:space-between;font-size:0.9rem;margin-bottom:8px}
  .bar{
    width:100%;
    height:12px;
    background:rgba(255,255,255,0.02);
    border-radius:10px;
    overflow:hidden;
  }
  .bar > i{
    display:block;height:100%;width:0;background:linear-gradient(90deg,var(--a1),var(--a2));
    transition:width 1s cubic-bezier(.2,.9,.2,1);
  }

  /* Main area */
  .main{display:flex;flex-direction:column;gap:18px;}
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .filter-btn{padding:8px 12px;background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);border-radius:10px;cursor:pointer;}
  .filter-btn.active{background:linear-gradient(90deg,var(--a1),var(--a2));color:#041026;border:none;}

  .projects{display:grid;grid-template-columns: repeat(auto-fit, minmax(220px,1fr));gap:16px;}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:12px;
    overflow:hidden;
    transition:transform .25s ease, box-shadow .25s ease, opacity .5s ease;
    border:1px solid rgba(255,255,255,0.03);
    display:flex;flex-direction:column;
    cursor:pointer;
    opacity:0; transform:translateY(8px);
  }
  .card.visible{opacity:1; transform:none;}
  .card:hover{transform:translateY(-8px);box-shadow:0 20px 60px rgba(2,6,23,0.6)}
  .card .media{background:#071428;display:block;position:relative;aspect-ratio:16/9;height:auto;}
  @supports not (aspect-ratio: 1 / 1) {
    .card .media{ position:relative; }
    .card .media::before{ content:""; display:block; padding-top:56.25%; }
    .card .media > img, .card .media > video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
  }
  .card img{width:100%;height:100%;object-fit:cover;display:block;filter:blur(6px);transition:filter .6s ease, opacity .6s ease;opacity:0.98}
  .card img.loaded{filter:none; opacity:1}
  .card .body{padding:16px;flex:1;display:flex;flex-direction:column}
  .card h4{margin:0;font-size:1rem}
  .card p{margin:8px 0 10px 0;color:var(--muted);font-size:0.95rem;flex:1}
  .tags{display:flex;gap:8px;flex-wrap:wrap}
  .tag{font-size:0.8rem;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted)}

  .chart-box{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
    /* Fix for auto-scrolling issue */
    overflow: hidden;
  }
  .chart-box canvas{ width:100% !important; display:block; }

  .right-align{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
  .muted-block{color:var(--muted);font-size:0.9rem}

  .ai-controls{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .textarea{width:100%;min-height:72px;padding:10px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.03);color:inherit;resize:vertical}
  img, video{max-width:100%;height:auto;display:block}
  .actions .btn, .actions .filter-btn{max-width:100%;white-space:normal;min-width:0}
  .muted, .contacts{overflow-wrap:anywhere;word-break:break-word}

  footer{margin-top:26px;text-align:center;color:var(--muted);font-size:0.9rem}

  /* modal */
  .modal-backdrop{
    position:fixed;inset:0;background:linear-gradient(180deg, rgba(1,4,10,0.6), rgba(1,4,10,0.75));
    display:grid;place-items:center;z-index:40;padding:20px;
  }
  .modal-content{
    width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 24px 60px rgba(0,0,0,0.6);
    display:grid;grid-template-columns:1fr 360px;gap:16px;
  }
  .modal-left img{width:100%;height:auto;max-height:340px;object-fit:cover;border-radius:8px}
  .modal-right{display:flex;flex-direction:column;gap:8px}
  .close-x{position:absolute;right:18px;top:18px;cursor:pointer;font-size:22px;color:var(--muted)}
  @media (max-width:900px){
    .modal-content{grid-template-columns:1fr;max-height:90vh;overflow:auto}
    .modal-left img{height:220px}
  }

  /* resume progress */
  .loader{
    width:20px;height:20px;border-radius:50%;border:3px solid rgba(255,255,255,0.08);border-top-color:var(--a1);animation:spin 1s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}

  /* tiny helpers */
  .search{background:rgba(255,255,255,0.02);border-radius:10px;padding:8px 10px;border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:8px}
  .search input{background:transparent;border:none;outline:none;color:inherit;font-size:0.95rem;width:100%;min-width:0}

  /* animated accent shift */
  @keyframes accentShift {
    0% { --a1: #38bdf8; --a2: #6366f1; }
    25%{ --a1: #7c3aed; --a2: #06b6d4; }
    50% { --a1: #06b6d4; --a2: #7c3aed; }
    75% { --a1: #06d6a0; --a2: #89f7fe; }
    100% { --a1: #38bdf8; --a2: #6366f1; }
  }
  html{ animation: accentShift 14s ease-in-out infinite; }

  /* small responsive tweaks for footer and mobile cards */
  @media (max-width:420px){
    .avatar{width:96px;height:96px}
    header{padding:12px}
  }

  /* Mobile-first responsive enhancements */
  .charts-grid{ display:grid; grid-template-columns:1fr 320px; gap:16px; }
  @media (max-width:980px){ .charts-grid{ grid-template-columns:1fr; } }

  @media (max-width:780px){
    .container{ margin:16px auto; padding:14px; }
    header{ flex-direction:column; align-items:stretch; gap:12px; }
    .left{ gap:12px; }
    .actions{ width:100%; flex-wrap:wrap; gap:8px; }
    .actions .btn, .actions .filter-btn{ flex:1 1 auto; }
    .search{ flex:1 1 100%; }
    .search input{ width:100%; }
    .grid{ gap:16px; }
  }
  @media (max-width:600px){
    h1{ font-size:1.2rem; }
    p.role{ font-size:0.95rem; }
    .projects{ grid-template-columns: 1fr; }
    #projectsChart{ height:220px !important; }
  }
  @media (max-width:480px){
    .avatar{ width:72px; height:72px; }
    .btn{ padding:9px 12px; }
    #dataChart{ height:260px !important; }
  }

  /* Embed-friendly overrides (e.g., Notion) */
  html.embed #bgCanvas,
  html.embed #waveCanvas,
  html.embed #bgVideo,
  html.embed #bgOverlay{ display:none !important; }
  html.embed body{ background:#061223; }
  html.embed .container{ max-width:100%; margin:0 auto; padding:12px; }
  html.embed .grid{ grid-template-columns:1fr; gap:16px; }
  html.embed .avatar{ width:96px; height:96px; }
  html.embed footer{ font-size:0.85rem }
  
  /* Fix for auto-scrolling issue */
  #projectsChart {
    max-height: 260px;
    width: 100% !important;
  }

  /* Workflow diagram styles */
  .workflow-container {
    background: rgba(255,255,255,0.02);
    border-radius: 8px;
    padding: 15px;
    margin: 10px 0;
    border: 1px solid rgba(255,255,255,0.05);
  }
  
  .mermaid {
    background: transparent !important;
    text-align: center;
  }
  
  .workflow-title {
    color: var(--a1);
    font-size: 0.9em;
    font-weight: 600;
    margin-bottom: 8px;
    text-align: center;
  }
</style>
</head>
<body>

<!-- background video -->
<canvas id="waveCanvas"></canvas>
<canvas id="bgCanvas"></canvas>
<video id="bgVideo" autoplay muted loop playsinline preload="auto">
  <source src="https://cdn.pixabay.com/video/2024/03/15/204292-923909617_tiny.mp4" type="video/mp4" />
</video>
<div id="bgOverlay"></div>

<div class="container">
  <header>
    <div class="left">
      <div class="avatar" title="Profile photo">
        <img src="https://raw.githubusercontent.com/KMK-tech-v0/personal-webprofile/main/assets/profile-photo.jpg" alt="Kaung Myat Kyaw profile photo" />
      </div>
      <div>
        <h1>Kaung Myat Kyaw</h1>
        <p class="role">Data Analyst - (Experienced in: Telecom, Manufacturing and Sale)</p>
        <div class="contacts muted">📍 Yangon, Myanmar<br>
          📧 kaungmyatkyaw446844590@gmail.com<br>
          📞 +95 9446844590
        </div>
      </div>
    </div>

    <div class="actions">
      <div class="search" title="Search projects">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"/></svg>
        <input id="searchInput" placeholder="Search projects..." />
      </div>

      <button id="downloadResumeBtn" class="btn" title="Download resume (PDF)">📄 Download Resume</button>
    </div>
  </header>

  <div class="grid">
    <!-- Sidebar -->
    <aside class="sidebar">

      <div class="block">
        
        <h3>Professional Summary</h3>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li>Experienced professional with 9+ years across telecom data analysis, production management, sales, and office administration. Skilled at turning raw data into actionable insights and improving processes with modern analytics. 
            Recognized for leadership, problem-solving, and adaptability.</li>
          <li>SQL, Python, R, Power BI, Tableau, and Excel; Data cleaning, and stakeholder communication, cross-functional partner who leads with clarity,
          loops, and measurable outcomes.</li>
        </ul>
      </div>

      <div class="block">
        <h3>Personal Info</h3>
        <div class="muted">
          📍 No.27, Pathein Nyunt 6st, Mingalar Taungnyunt Tsp, Yangon, Myanmar<br>
          🎂 Date of Birth: January 6, 1998<br>
          🔗 LinkedIn: <a href="https://www.linkedin.com/in/kaung-myat-kyaw-96705231a/" target="_blank" style="color: var(--a1);">linkedin.com/in/kaung-myat-kyaw</a><br>
          💻 GitHub: <a href="https://github.com/KMK-tech-v0" target="_blank" style="color: var(--a1);">KMK-tech-v0</a><br>
          🌐 Portfolio: <a href="https://kmk-tech-v0.github.io/personal-webprofile/" target="_blank" style="color: var(--a1);">My Portfolio</a>
        </div>
      </div>

      <div class="block">
        <h3>Core Competencies</h3>
        <ul class="muted">
          <li>Data Analysis & Visualization</li>
          <li>SQL & Database Management</li>
          <li>Python & R Programming</li>
          <li>Power BI & Excel Reporting</li>
          <li>Data Cleaning & Validation</li>
          <li>Modeling & Dashboards</li>
          <li>Process Optimization</li>
          <li>Cross-functional Collaboration</li>
          <li>Leadership & Training</li>
        </ul>
      </div>

      <div class="block">
        <h3>Technical Skills</h3>
        <div id="technicalSkillsList">
          <!-- JS populates technical skills -->
        </div>
      </div>

      <div class="block">
        <h3>Soft Skills</h3>
        <div id="softSkillsList">
          <!-- JS populates soft skills -->
        </div>
      </div>

      <div class="block">
        <h3>Education</h3>
        <div class="muted">
          B.A. History — Kyaukse University, Mandalay (Jun 2018)<br>
          Business in Marketing (IQN) — MIBA, Yangon (Nov 2018)<br>
          Business in English (IQN) — MIBA, Yangon (Expected Nov 2024)
        </div>
      </div>

      <div class="block">
        <h3>Certifications & Training</h3>
        <ul class="muted" style="margin:0; padding-left:18px">
          <li>Standard Operating Procedure (SOP) — Myanmar Nilar Food Stuff Co. Ltd</li>
          <li>ISO 22000 — Nilar Frozen Foods Co. Ltd</li>
          <li>HACCP — Nilar Frozen Foods Co. Ltd</li>
          <li>Customer Service — Myanmar Nilar Food Stuff Co. Ltd</li>
          <li>Leadership & Management — Myanmar Nilar Food Stuff Co. Ltd</li>
        </ul>
      </div>

      <div class="block">
        <h3>Hobbies & Interests</h3>
        <div class="muted">
          Programming & Coding · Learning New Technologies · Photography · Puzzles & Logical Games
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="chart-box">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="margin:0;color:var(--a1)">Portfolio & Projects</h3>
          <div class="right-align">
            <div class="muted-block">Filter:</div>
            <div id="filters" class="controls"></div>
          </div>
        </div>

        <div style="margin-top:14px" id="projectsGrid" class="projects">
          <!-- JS inserts project cards -->
        </div>
      </div>

      <!-- Charts -->
      <div class="charts-grid">
        <div class="chart-box">
          <h3 style="color:var(--a1);margin-top:0">Project Metrics</h3>
          <canvas id="projectsChart" style="height:260px"></canvas>
        </div>

        <div class="chart-box">
          <h3 style="color:var(--a1);margin-top:0">Quick Actions</h3>
          <div style="margin-top:10px">
            <button id="generateSummaries" class="btn" style="width:100%;">Generate Project Summaries</button>
            <div style="margin-top:12px">
              <button id="showAllBtn" class="filter-btn" style="width:100%;">Show All Projects</button>
            </div>
            <div style="margin-top:12px">
              <label class="muted">AI Summary (template)</label>
              <textarea id="aiSummary" class="textarea" placeholder="Select a project and click Generate..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="chart-box">
        <h3 style="color:var(--a1)">Professional Experience</h3>
        <div style="margin-top:12px" class="muted">
          <div style="margin-bottom:16px;">
            <strong style="color:var(--a1);">Data Analyst (Telecom — MPT cooperate)</strong><br>
            <strong>Myanmar Padauk Engineering & Construction Co., Ltd</strong> (Mar 2024 – Present)<br>
            <small style="color:#7f8c8d;">Yangon, Myanmar</small>
            <ul style="margin:6px 0 0 18px; font-size:0.9em;">
              <li>Gather and compile telecom data from network logs and usage records</li>
              <li>Ensure data integrity via validation and quality checks; maintain databases</li>
              <li>Analyze data to identify trends, patterns, and anomalies; produce actionable insights</li>
              <li>Develop and maintain dashboards, reports, and visualizations</li>
              <li>Share findings in meetings and contribute to decision-making</li>
            </ul>
          </div>
          
          <div style="margin-bottom:16px;">
            <strong style="color:var(--a1);">Production Assistant Manager</strong><br>
            <strong>Nilar Frozen Foods Co., Ltd</strong> (May 2021 – Feb 2024)<br>
            <small style="color:#7f8c8d;">Nay Pyi Taw, Myanmar</small>
            <ul style="margin:6px 0 0 18px; font-size:0.9em;">
              <li>Implemented production schedules; coordinated resources for efficient processes</li>
              <li>Monitored progress and adjusted plans to meet targets and shipment timelines</li>
              <li>Maintained quality standards and safety compliance; led corrective actions</li>
              <li>Supervised and trained staff; fostered a positive work environment</li>
            </ul>
          </div>
          
          <div style="margin-bottom:16px;">
            <strong style="color:var(--a1);">Personal Assistant</strong><br>
            <strong>Nilar Holding Co., Ltd</strong> (Sep 2019 – Nov 2021)<br>
            <small style="color:#7f8c8d;">Yangon, Myanmar</small>
            <ul style="margin:6px 0 0 18px; font-size:0.9em;">
              <li>Managed executive schedules and travel; prepared reports and communications</li>
              <li>Planned and coordinated events and meetings; handled logistics and budgeting</li>
              <li>Supported research, data collection, and analysis</li>
            </ul>
          </div>
          
          <div style="margin-bottom:16px;">
            <strong style="color:var(--a1);">Sales & Marketing Supervisor</strong><br>
            <strong>Myanmar Nilar Food Stuffs</strong> (Feb 2017 – Aug 2019)<br>
            <small style="color:#7f8c8d;">Yangon, Myanmar</small>
            <ul style="margin:6px 0 0 18px; font-size:0.9em;">
              <li>Developed and implemented sales strategies; handled customer inquiries</li>
              <li>Monitored and analyzed sales performance; reported insights to management</li>
            </ul>
          </div>
          
          <div style="margin-bottom:12px;">
            <strong style="color:var(--a1);">Additional Experience:</strong><br>
            <div style="font-size:0.9em; margin-top:6px;">
              • <strong>Warehouse Assistant</strong> — Pro-One Home Center (Dec 2015 – Oct 2016)<br>
              • <strong>Interviewer (Intern)</strong> — Neilsen MMRD (Jan 2016 – Apr 2016)<br>
              • <strong>Office Executive</strong> — ITN Company Limited (Jul 2014 – Oct 2015)
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <footer>
    Built with ❤ — "BETTER LATE THAN NEVER".
  </footer>
</div>

<!-- modal region -->
<div id="modalRoot" aria-hidden="true"></div>

<script>
// Detect Notion/embed context (iframe) or ?embed=1 flag
const IS_EMBED = (window.self !== window.top) || new URLSearchParams(location.search).get('embed') === '1';
if (IS_EMBED) document.documentElement.classList.add('embed');

// Initialize Mermaid
mermaid.initialize({
  startOnLoad: true,
  theme: 'dark',
  themeVariables: {
    primaryColor: '#38bdf8',
    primaryTextColor: '#e6eef6',
    primaryBorderColor: '#6366f1',
    lineColor: '#9aa6b2',
    secondaryColor: '#0f1724',
    tertiaryColor: '#071024'
  },
  flowchart: {
    useMaxWidth: true,
    htmlLabels: true
  }
});

/* =========================
   DATASETS — projects expanded (8 projects) with demo CSV data
   ========================= */
const PROFILE = {
  name: "Kaung Myat Kyaw",
  title: "Data Analyst",
  contact: {
    email: "kaungmyatkyaw446844590@gmail.com",
    phone: "+95 9446844590",
    location: "Yangon, Myanmar"
  },
  technicalSkills: [
    { name: "Microsoft Excel", lvl: 95 },
    { name: "MySQL", lvl: 80 },
    { name: "Python", lvl: 70 },
    { name: "R Programming", lvl: 60 },
    { name: "Power BI", lvl: 70 },
    { name: "Data Cleaning", lvl: 95 },
    { name: "HTML", lvl: 70 },
    { name: "Microsoft PowerPoint", lvl: 80 },
    { name: "Tableau", lvl: 60 }
  ],
  softSkills: [
    { name: "Problem Solving", lvl: 100},
    { name: "Critical Thinking", lvl: 100},
    { name: "Fast Learning", lvl: 100},
    { name: "Detail Orientative", lvl: 100},
    { name: "Leadership", lvl: 100},
    { name: "Process Synchronization", lvl: 100}
  ],
  projects: [
    {
      id: "p1",
      title: "Cell Availability Processing System",
      description: "Automated Python script for processing weekly cell availability data from Excel files. Extracts date ranges, normalizes columns, and transforms data into long format with week calculations for telecom network analysis.",
      tools: ["Python","Pandas","Excel","Data Processing"],
      image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 1850, interactions: 420, score: 92 },
      dataset: generateDemoTimeseries("CellAvailability", 52, 85, 99),
      workflow: "ca_processing"
    },
    {
      id: "p2",
      title: "Work Order Management Pipeline",
      description: "Comprehensive work order processing system with automated data cleaning, standardization, and enhancement. Features RFO classification, SA/NSA detection, and priority assignment from alarm data.",
      tools: ["Python","Pandas","Regex","Data Cleaning"],
      image: "https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 1650, interactions: 380, score: 89 },
      dataset: generateDemoTable(["ticket_id","site_id","priority","duration"], 500),
      workflow: "wo_processing"
    },
    {
      id: "p3",
      title: "Response Protocols Workflow Dashboard",
      description: "Interactive HTML dashboard with Mermaid diagrams for incident response protocols. Features security, technical, and logistics workflows with severity-based filtering and PDF export capabilities.",
      tools: ["HTML","JavaScript","Mermaid.js","CSS"],
      image: "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 1200, interactions: 290, score: 88 },
      dataset: generateDemoTable(["protocol_id","severity","type","status"], 13),
      workflow: "response_protocols"
    },
    {
      id: "p4",
      title: "Fiber Fault Report Data Entry App",
      description: "Full-stack Flask application for fiber fault reporting with location mapping, material selection, photo uploads, and monitoring dashboard. Features dynamic region loading and CRUD operations.",
      tools: ["Flask","Python","HTML","JavaScript","SQL"],
      image: "https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 980, interactions: 220, score: 85 },
      dataset: generateDemoTable(["report_id","location","material","status"], 150),
      workflow: "fiber_fault_app"
    },
    {
      id: "p5",
      title: "Outlook Mail Auto Reader",
      description: "Python-based email automation solution supporting both Microsoft Graph API and IMAP protocols. Features OAuth 2.0 authentication, attachment downloads, and multi-folder support for Outlook integration.",
      tools: ["Python","Microsoft Graph API","IMAP","OAuth 2.0"],
      image: "https://images.unsplash.com/photo-1596526131083-e8c633c948d2?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 750, interactions: 165, score: 82 },
      dataset: generateDemoTable(["email_id","sender","subject","read_status"], 200),
      workflow: "outlook_reader"
    },
    {
      id: "p6",
      title: "Telecom Outage Dashboard (React Native)",
      description: "Mobile-optimized React Native application for telecom outage management. Features Gantt charts, real-time site monitoring, and comprehensive sample datasets covering Myanmar telecom infrastructure.",
      tools: ["React Native","TypeScript","Expo","Mobile Development"],
      image: "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 1100, interactions: 250, score: 87 },
      dataset: generateDemoTable(["site_id","status","technology","region"], 180),
      workflow: "mobile_dashboard"
    },
    {
      id: "p7",
      title: "Telecom Network Analysis Implementation",
      description: "Comprehensive Streamlit-based analysis platform integrating outage data, work orders, and cell availability metrics. Features interactive dashboards, geographic mapping, and critical site identification.",
      tools: ["Streamlit","Python","Plotly","Data Analysis"],
      image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 2200, interactions: 520, score: 94 },
      dataset: generateDemoTimeseries("NetworkMetrics", 365, 50, 100),
      workflow: "network_analysis"
    },
    {
      id: "p8",
      title: "GitHub Portfolio Integration",
      description: "Multi-repository project showcase featuring fuel tracking system, data processing integration, and telecom KPI analysis. Demonstrates full-stack development and data engineering capabilities.",
      tools: ["Git","GitHub","Portfolio Management","Documentation"],
      image: "https://images.unsplash.com/photo-1618477388954-7852f32655ec?q=80&w=1400&auto=format&fit=crop&crop=entropy",
      metrics: { views: 650, interactions: 140, score: 79 },
      dataset: generateDemoTable(["repo_name","language","stars","commits"], 8),
      workflow: "github_integration"
    }
  ]
};

/* =========================
   Workflow Diagrams for Projects
   ========================= */
const WORKFLOW_DIAGRAMS = {
  ca_processing: {
    title: "Cell Availability Processing Workflow",
    diagram: `flowchart TD
      A[Excel Files in Raw Folder] --> B[Extract Date Range from Filename]
      B --> C[Load Excel Data]
      C --> D[Rename Site ID Column]
      D --> E[Normalize Date Columns]
      E --> F[Melt to Long Format]
      F --> G[Add Week Column]
      G --> H[Clean Column Names]
      H --> I[Save Processed Data]
      I --> J[Output: moc_weekly_ca_*.xlsx]
      
      style A fill:#e1f5fe
      style J fill:#c8e6c9
      style F fill:#fff3e0`
  },
  wo_processing: {
    title: "Work Order Processing Pipeline",
    diagram: `flowchart TD
      A[Shift Handover Excel] --> B[Clean Column Names]
      B --> C[Standardize Dates & Duration]
      C --> D[Extract SA/NSA from Alarm]
      D --> E[Detect Priority Level]
      E --> F[Get Alarm Severity]
      F --> G[Update RFO Classification]
      G --> H[Apply Pattern Matching]
      H --> I[Save Enhanced Data]
      I --> J[Output: wo_YYYY_Mon.xlsx]
      
      style A fill:#e1f5fe
      style J fill:#c8e6c9
      style G fill:#fff3e0`
  },
  response_protocols: {
    title: "Response Protocols Dashboard Flow",
    diagram: `flowchart TD
      A[Protocol Data] --> B[Generate Mermaid Diagrams]
      B --> C[Render Protocol Cards]
      C --> D[Apply Severity Filtering]
      D --> E[Interactive Dashboard]
      E --> F[PDF Export]
      E --> G[JSON Data Export]
      
      H[User Interaction] --> I[Filter by Type]
      I --> J[Security/Technical/Logistics]
      J --> D
      
      style A fill:#e1f5fe
      style E fill:#fff3e0
      style F fill:#c8e6c9
      style G fill:#c8e6c9`
  },
  fiber_fault_app: {
    title: "Fiber Fault Reporting App Architecture",
    diagram: `flowchart TD
      A[Frontend Form] --> B[Location Mapping]
      B --> C[Material Selection]
      C --> D[Photo Upload]
      D --> E[Flask Backend]
      E --> F[Database Storage]
      F --> G[Monitoring Dashboard]
      G --> H[CRUD Operations]
      
      I[Dynamic Region Loading] --> B
      J[Material Database] --> C
      
      style A fill:#e1f5fe
      style E fill:#fff3e0
      style G fill:#c8e6c9`
  },
  outlook_reader: {
    title: "Outlook Mail Reader Integration",
    diagram: `flowchart TD
      A[Authentication] --> B{API Choice}
      B -->|Graph API| C[OAuth 2.0 Flow]
      B -->|IMAP| D[App Password]
      C --> E[Microsoft Graph API]
      D --> F[IMAP Connection]
      E --> G[Read Emails]
      F --> G
      G --> H[Download Attachments]
      H --> I[Mark as Read]
      I --> J[Multi-folder Support]
      
      style A fill:#e1f5fe
      style G fill:#fff3e0
      style J fill:#c8e6c9`
  },
  mobile_dashboard: {
    title: "React Native Mobile Dashboard",
    diagram: `flowchart TD
      A[React Native App] --> B[TypeScript Components]
      B --> C[Gantt Chart View]
      B --> D[Site Monitoring]
      C --> E[Real-time Updates]
      D --> E
      E --> F[Myanmar Telecom Data]
      F --> G[Mobile Optimization]
      G --> H[Expo Deployment]
      
      style A fill:#e1f5fe
      style E fill:#fff3e0
      style H fill:#c8e6c9`
  },
  network_analysis: {
    title: "Telecom Network Analysis Platform",
    diagram: `flowchart TD
      A[Multiple Data Sources] --> B[Data Integration]
      B --> C[Streamlit Dashboard]
      C --> D[Interactive Filtering]
      C --> E[Geographic Mapping]
      C --> F[Critical Site Analysis]
      D --> G[Real-time KPIs]
      E --> G
      F --> G
      G --> H[Executive Reports]
      
      style A fill:#e1f5fe
      style C fill:#fff3e0
      style H fill:#c8e6c9`
  },
  github_integration: {
    title: "GitHub Portfolio Integration",
    diagram: `flowchart TD
      A[Multiple Repositories] --> B[Fuel Tracker]
      A --> C[Data Processing]
      A --> D[Telecom KPI Analysis]
      B --> E[Portfolio Showcase]
      C --> E
      D --> E
      E --> F[Documentation]
      F --> G[Full-stack Demo]
      
      style A fill:#e1f5fe
      style E fill:#fff3e0
      style G fill:#c8e6c9`
  }
};

/* =========================
   Utility dataset generators (for demo CSV / downloads)
   ========================= */
function generateDemoTimeseries(name, points=24, min=100, max=1000){
  const out = [];
  const now = Date.now();
  for(let i=points-1;i>=0;i--){
    const ts = new Date(now - i * 3600*1000).toISOString(); // hourly points
    const value = Math.round(min + Math.random()*(max-min));
    out.push({ timestamp: ts, metric: name, value });
  }
  return out;
}
function generateDemoTable(cols, rows=20){
  const out = [];
  for(let i=0;i<rows;i++){
    const row = {};
    cols.forEach(c=>{
      if(c.includes("id")) row[c] = `ID${1000+i}`;
      else if(c.toLowerCase().includes("price") || c.toLowerCase().includes("charge")) row[c] = (Math.random()*100).toFixed(2);
      else if(c.toLowerCase().includes("score") || c.toLowerCase().includes("prob")) row[c] = Math.round(Math.random()*100);
      else if(c.toLowerCase().includes("site")) row[c] = ["A","B","C","D"][Math.floor(Math.random()*4)];
      else if(c.toLowerCase().includes("segment")) row[c] = ["HighValue","Mid","Low"][Math.floor(Math.random()*3)];
      else if(c.toLowerCase().includes("churn")) row[c] = Math.random() > 0.8 ? 1 : 0;
      else row[c] = Math.round(Math.random()*100);
    });
    out.push(row);
  }
  return out;
}

/* =========================
   Background: wave + particles
   optimized for performance
   ========================= */
const waveCanvas = document.getElementById('waveCanvas');
const bgCanvas = document.getElementById('bgCanvas');
const wctx = waveCanvas.getContext('2d');
const bctx = bgCanvas.getContext('2d');

let DPR = window.devicePixelRatio || 1;
function resizeAll(){
  DPR = window.devicePixelRatio || 1;
  for(const c of [waveCanvas, bgCanvas]){
    c.width = innerWidth * DPR;
    c.height = innerHeight * DPR;
    c.style.width = innerWidth + 'px';
    c.style.height = innerHeight + 'px';
    const ctx = c === waveCanvas ? wctx : bctx;
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
}
window.addEventListener('resize', resizeAll);
resizeAll();

// If background video is available, prefer it and stop canvas animation
const bgVideoEl = document.getElementById('bgVideo');
if (bgVideoEl) {
  const onCanPlay = () => {
    bgVideoEl.style.display = 'block';
    waveCanvas.style.display='none';
    bgCanvas.style.display='none';
    bgAnimActive = false;
    if (bgAnimFrame) cancelAnimationFrame(bgAnimFrame);
  };
  bgVideoEl.addEventListener('canplay', onCanPlay, { once:true });
  bgVideoEl.addEventListener('error', () => {
    // fallback to canvases
    bgVideoEl.style.display = 'none';
    waveCanvas.style.display='block';
    bgCanvas.style.display='block';
    if (!bgAnimActive) {
      bgAnimActive = true;
      bgAnimFrame = requestAnimationFrame(drawBackground);
    }
  }, { once:true });
}

// particles simplified
const particles = [];
const PARTICLES = IS_EMBED ? 0 : Math.max(24, Math.floor((innerWidth*innerHeight)/120000));
for(let i=0;i<PARTICLES;i++){
  particles.push({
    x: Math.random()*innerWidth,
    y: Math.random()*innerHeight,
    r: 0.6 + Math.random()*2.4,
    vx: (Math.random()-0.5)*0.4,
    vy: (Math.random()-0.5)*0.3,
    hue: 190 + Math.random()*120,
    alpha: 0.06 + Math.random()*0.16
  });
}

let wavePhase = 0;
let bgAnimActive = true;
let bgAnimFrame = null;
if (IS_EMBED) { bgAnimActive = false; }
function drawBackground(){
  if(!bgAnimActive) return;
  // wave gradient (soft)
  const g = wctx.createLinearGradient(0,0,innerWidth,innerHeight);
  g.addColorStop(0, 'rgba(6,18,35,0.7)');
  g.addColorStop(1, 'rgba(3,9,18,0.7)');
  wctx.fillStyle = g;
  wctx.fillRect(0,0,innerWidth,innerHeight);

  // waves
  wavePhase += 0.0025;
  const waveCount = 3;
  for(let k=0;k<waveCount;k++){
    const amp = 10 + k*12;
    const freq = 0.0009 + k*0.0008;
    const offsetY = innerHeight*(0.75 - k*0.06);
    wctx.beginPath();
    const grad = wctx.createLinearGradient(0,0,innerWidth,0);
    const c1 = k%2===0 ? getComputedStyle(document.documentElement).getPropertyValue('--a1').trim() : getComputedStyle(document.documentElement).getPropertyValue('--a2').trim();
    grad.addColorStop(0, hexToRgba(c1, 0.06 + k*0.02));
    grad.addColorStop(1, hexToRgba(c1, 0.01 + k*0.01));
    wctx.fillStyle = grad;
    wctx.moveTo(0, innerHeight);
    for(let x=0;x<=innerWidth;x+=24){
      const y = offsetY + Math.sin((x*freq) + wavePhase*(1+k*0.6)) * amp * Math.sin(wavePhase* (0.6+k*0.2));
      wctx.lineTo(x, y);
    }
    wctx.lineTo(innerWidth, innerHeight);
    wctx.closePath();
    wctx.fill();
  }

  // particles
  bctx.clearRect(0,0,innerWidth,innerHeight);
  for(const p of particles){
    p.x += p.vx;
    p.y += p.vy;
    if(p.x < -20) p.x = innerWidth + 20;
    if(p.x > innerWidth + 20) p.x = -20;
    if(p.y < -20) p.y = innerHeight + 20;
    if(p.y > innerHeight + 20) p.y = -20;

    bctx.beginPath();
    bctx.fillStyle = `hsla(${p.hue},80%,65%,${p.alpha})`;
    bctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    bctx.fill();
  }

  bgAnimFrame = requestAnimationFrame(drawBackground);
}
bgAnimFrame = requestAnimationFrame(drawBackground);

function hexToRgba(hex, a){
  // handle #xxxxxx or rgb var formats (basic)
  try{
    const ctx = document.createElement('canvas').getContext('2d');
    ctx.fillStyle = hex;
    const computed = ctx.fillStyle; // "rgb(r,g,b)"
    const m = computed.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
    if(m) return `rgba(${m[1]},${m[2]},${m[3]},${a})`;
  }catch(e){}
  return `rgba(60,160,220,${a})`;
}

/* =========================
   Render skills & animate visibility
   ========================= */
const technicalSkillsEl = document.getElementById('technicalSkillsList');
const softSkillsEl = document.getElementById('softSkillsList');

function renderSkillsSection(skillsArray, containerEl) {
  containerEl.innerHTML = '';
  skillsArray.forEach((s, idx)=>{
    const d = document.createElement('div');
    d.className = 'skill';
    d.innerHTML = `
      <div class="meta"><div>${escapeHtml(s.name)}</div><div>${s.lvl}%</div></div>
      <div class="bar"><i data-lvl="${s.lvl}"></i></div>
    `;
    containerEl.appendChild(d);
  });
}

function renderSkills(){
  renderSkillsSection(PROFILE.technicalSkills, technicalSkillsEl);
  renderSkillsSection(PROFILE.softSkills, softSkillsEl);
}
renderSkills();

// animate skill bars when visible
function createSkillObserver(skillsContainer) {
  return new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        entry.target.querySelectorAll('i').forEach(i=>{
          const lvl = i.getAttribute('data-lvl');
          setTimeout(()=> i.style.width = (lvl)+'%', 80);
        });
        // reveal each .skill child with stagger
        Array.from(skillsContainer.children).forEach((c, idx)=>{
          setTimeout(()=> c.classList.add('visible'), idx*120);
        });
      }
    });
  },{threshold:0.2});
}

const technicalSkillObserver = createSkillObserver(technicalSkillsEl);
const softSkillObserver = createSkillObserver(softSkillsEl);
technicalSkillObserver.observe(technicalSkillsEl);
softSkillObserver.observe(softSkillsEl);

/* =========================
   Projects render + search + filters + modal
   ========================= */
const projectsGrid = document.getElementById('projectsGrid');
const filtersEl = document.getElementById('filters');
const searchInput = document.getElementById('searchInput');
const modalRoot = document.getElementById('modalRoot');

let allTools = new Set();
PROFILE.projects.forEach(p=>p.tools.forEach(t=>allTools.add(t)));
allTools = Array.from(allTools).sort();

/* render filters */
const filterButtons = [];
function renderFilters(){
  filtersEl.innerHTML = '';
  const btnAll = document.createElement('button');
  btnAll.className = 'filter-btn active';
  btnAll.textContent = 'All';
  btnAll.dataset.tool = 'all';
  filtersEl.appendChild(btnAll);
  filterButtons.push(btnAll);
  btnAll.addEventListener('click', ()=> applyFilter('all'));

  allTools.forEach(tool=>{
    const b = document.createElement('button');
    b.className = 'filter-btn';
    b.textContent = tool;
    b.dataset.tool = tool;
    filtersEl.appendChild(b);
    filterButtons.push(b);
    b.addEventListener('click', ()=> applyFilter(tool));
  });
}
renderFilters();

function makeProjectCard(p){
  const card = document.createElement('article');
  card.className = 'card';
  card.dataset.tools = p.tools.join(',');
  card.innerHTML = `
    <div class="media">
      <img loading="lazy" alt="${escapeHtml(p.title)}" data-src="${p.image}" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='340'><rect width='100%' height='100%' fill='%23061a2a'/></svg>" />
    </div>
    <div class="body">
      <h4>${escapeHtml(p.title)}</h4>
      <p>${escapeHtml(p.description)}</p>
      <div class="tags">${p.tools.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      <div style="display:flex;justify-content:space-between;margin-top:10px;align-items:center">
        <small class="muted">${p.metrics.score}% score · ${p.metrics.views} views</small>
        <div style="display:flex;gap:8px">
          <button class="filter-btn btn-view" data-id="${p.id}">View</button>
          <button class="filter-btn btn-download" data-id="${p.id}">CSV</button>
        </div>
      </div>
    </div>
  `;
  // lazy load image
  // lazy load image
  const mediaDiv = card.querySelector('.media');
  const isVideo = /\.mp4($|\?)/i.test(p.image);
  if (isVideo) {
    mediaDiv.innerHTML = `<video class=\"media-video\" autoplay muted loop playsinline src=\"${p.image}\"></video>`;
  } else {
    const img = mediaDiv.querySelector('img');
    // per-project image adjustments for better display
    if (p.id === 'p1' || p.id === 'p7') { img.style.objectPosition = '50% 30%'; }
    if (p.id === 'p2') { img.style.objectPosition = '50% 20%'; }
    if (p.id === 'p3') { img.style.objectPosition = '50% 40%'; }
    if (p.id === 'p4') { img.style.objectPosition = '50% 25%'; }
    if (p.id === 'p5') { img.style.objectPosition = '50% 35%'; }
    if (p.id === 'p6') { img.style.objectPosition = '50% 45%'; }
    if (p.id === 'p8') { img.style.objectPosition = '50% 30%'; }
    img.addEventListener('load', ()=> img.classList.add('loaded'));
    // Enhanced image loading with fallback - matching profile photo timeout
    setTimeout(()=>{
      const src = img.getAttribute('data-src');
      if(src) {
        // Create project-specific fallback SVG
        const createProjectFallback = () => {
          return `data:image/svg+xml;base64,${btoa(`
            <svg width="600" height="340" viewBox="0 0 600 340" fill="none" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="projGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#38bdf8;stop-opacity:0.8" />
                  <stop offset="100%" style="stop-color:#6366f1;stop-opacity:0.8" />
                </linearGradient>
              </defs>
              <rect width="600" height="340" fill="url(#projGrad)"/>
              <circle cx="300" cy="120" r="40" fill="white" opacity="0.9"/>
              <rect x="260" y="180" width="80" height="60" rx="8" fill="white" opacity="0.9"/>
              <rect x="220" y="260" width="160" height="20" rx="4" fill="white" opacity="0.7"/>
              <rect x="240" y="290" width="120" height="15" rx="3" fill="white" opacity="0.5"/>
              <text x="300" y="325" font-family="-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif" font-size="14" fill="white" text-anchor="middle" opacity="0.8">Project Image</text>
            </svg>
          `)}`;
        };
        
        loadImageWithFallback(img, [src], {
          timeout: 6000, // Match profile photo timeout
          retryDelay: 800, // Match profile photo retry delay
          onSuccess: () => {
            img.classList.add('loaded');
            img.style.filter = 'none';
            img.style.opacity = '1';
          },
          onFallback: () => {
            // Use professional project fallback instead of keeping placeholder
            img.src = createProjectFallback();
            img.style.filter = 'none';
            img.style.opacity = '1';
            img.classList.add('loaded');
          }
        });
      }
    }, 80);
  }
  // view button -> open modal
  card.querySelector('.btn-view').addEventListener('click', (e)=>{
    e.stopPropagation();
    openModal(p);
  });

  // CSV download
  card.querySelector('.btn-download').addEventListener('click', (e)=>{
    e.stopPropagation();
    downloadCsvForProject(p);
  });

  // click card -> open modal too
  card.addEventListener('click', ()=> openModal(p));

  return card;
}

function renderProjects(list = PROFILE.projects){
  projectsGrid.innerHTML = '';
  list.forEach((p, idx)=>{
    const card = makeProjectCard(p);
    projectsGrid.appendChild(card);
    // stagger reveal
    setTimeout(()=> card.classList.add('visible'), idx * 80);
  });
}
renderProjects();

/* search + filter logic */
let activeFilter = 'all';
function applyFilter(tool){
  activeFilter = tool;
  filterButtons.forEach(b=> b.classList.remove('active'));
  const match = filterButtons.find(b => b.dataset.tool === tool) || filterButtons[0];
  if(match) match.classList.add('active');
  applySearchAndFilter();
}
document.getElementById('showAllBtn').addEventListener('click', ()=> applyFilter('all'));

searchInput.addEventListener('input', ()=> applySearchAndFilter());

function applySearchAndFilter(){
  const q = (searchInput.value || '').trim().toLowerCase();
  const filtered = PROFILE.projects.filter(p=>{
    const passesFilter = activeFilter === 'all' ? true : p.tools.includes(activeFilter);
    const passesSearch = q === '' ? true :
      p.title.toLowerCase().includes(q) ||
      p.description.toLowerCase().includes(q) ||
      p.tools.join(' ').toLowerCase().includes(q);
    return passesFilter && passesSearch;
  });
  renderProjects(filtered);
}

/* modal implementation */
function openModal(project){
  modalRoot.innerHTML = '';
  modalRoot.setAttribute('aria-hidden', 'false');
  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop';
  backdrop.innerHTML = `
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="${escapeHtml(project.title)}">
      <div style="position:relative;">
        <span class="close-x" title="Close">&times;</span>
        <div class="modal-left">
          <img src="${project.image}" alt="${escapeHtml(project.title)}"/>
        </div>
      </div>
      <div class="modal-right">
        <h2 style="margin:0">${escapeHtml(project.title)}</h2>
        <div style="color:var(--muted);margin-bottom:8px">${escapeHtml(project.tools.join(' · '))}</div>
        <div style="flex:1;color:var(--muted);margin-bottom:8px">${escapeHtml(project.description)}</div>
        <div style="display:flex;gap:8px;">
          <button id="downloadCsvModal" class="btn">Download CSV</button>
          <button id="openWorkflowModal" class="filter-btn">View Workflow</button>
          <button id="closeModalBtn" class="filter-btn">Close</button>
        </div>
        <div style="margin-top:12px">
          <small class="muted">Metrics: ${project.metrics.score}% score · ${project.metrics.views} views · ${project.metrics.interactions} interactions</small>
        </div>
      </div>
    </div>
  `;
  modalRoot.appendChild(backdrop);

  // per-project modal image adjustments for better display
  const mimg = backdrop.querySelector('.modal-left img');
  if (mimg) {
    if (project.id === 'p1' || project.id === 'p7') { mimg.style.objectPosition = '50% 30%'; }
    if (project.id === 'p2') { mimg.style.objectPosition = '50% 20%'; }
    if (project.id === 'p3') { mimg.style.objectPosition = '50% 40%'; }
    if (project.id === 'p4') { mimg.style.objectPosition = '50% 25%'; }
    if (project.id === 'p5') { mimg.style.objectPosition = '50% 35%'; }
    if (project.id === 'p6') { mimg.style.objectPosition = '50% 45%'; }
    if (project.id === 'p8') { mimg.style.objectPosition = '50% 30%'; }
  }

  backdrop.querySelector('.close-x').addEventListener('click', closeModal);
  backdrop.querySelector('#closeModalBtn').addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=> { if(e.target === backdrop) closeModal(); });

  backdrop.querySelector('#downloadCsvModal').addEventListener('click', ()=> downloadCsvForProject(project));
  backdrop.querySelector('#openWorkflowModal').addEventListener('click', ()=>{
    openWorkflowModal(project);
  });
}

function closeModal(){
  modalRoot.innerHTML = '';
  modalRoot.setAttribute('aria-hidden', 'true');
}

/* CSV download helper */
function downloadCsvForProject(p){
  const data = p.dataset;
  if(!data || data.length === 0){
    alert('No dataset available for this project.');
    return;
  }
  // convert to CSV
  const keys = Array.from(new Set(data.flatMap(d => Object.keys(d))));
  const rows = data.map(r => keys.map(k => JSON.stringify((r[k] !== undefined) ? r[k] : '')).join(','));
  const csv = keys.join(',') + '\n' + rows.join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${p.id}_dataset.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* workflow modal for project diagrams */
function openWorkflowModal(project){
  const workflowData = WORKFLOW_DIAGRAMS[project.workflow];
  if (!workflowData) {
    alert('No workflow diagram available for this project.');
    return;
  }

  modalRoot.innerHTML = '';
  modalRoot.setAttribute('aria-hidden', 'false');
  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop';
  backdrop.innerHTML = `
    <div class="modal-content" role="dialog" aria-modal="true" style="max-width:1100px;">
      <div style="position:relative; grid-column:1/-1;">
        <span class="close-x" title="Close">&times;</span>
        <div class="workflow-title">${escapeHtml(workflowData.title)}</div>
        <div class="workflow-container">
          <div class="mermaid" id="workflowDiagram">
            ${workflowData.diagram}
          </div>
        </div>
        <div style="margin-top:15px; text-align:center;">
          <button class="btn" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>
  `;
  modalRoot.appendChild(backdrop);
  backdrop.querySelector('.close-x').addEventListener('click', closeModal);
  backdrop.addEventListener('click', (e)=> { if(e.target === backdrop) closeModal(); });

  // Re-initialize Mermaid for the new diagram
  setTimeout(() => {
    mermaid.init(undefined, document.getElementById('workflowDiagram'));
  }, 100);
}

/* =========================
   Projects Chart (overview)
   ========================= */
const projectsChartCtx = document.getElementById('projectsChart').getContext('2d');
let projectsChart;
function buildProjectChart(){
  const labels = PROFILE.projects.map(p=>p.title);
  const scores = PROFILE.projects.map(p=>p.metrics.score);
  const views = PROFILE.projects.map(p=>p.metrics.views);
  if(projectsChart) projectsChart.destroy();
  projectsChart = new Chart(projectsChartCtx, {
    type: 'bar',
    data:{
      labels,
      datasets:[
        { label:'Score (%)', data:scores, backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--a1').trim(), borderRadius:6, maxBarThickness:40 },
        { label:'Views', data:views, backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--a2').trim(), borderRadius:6, maxBarThickness:40 }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{ legend:{ labels:{ color:'#cfeefc' } } },
      scales:{
        x:{ ticks:{ color:'#9fb8c9' }, grid:{ display:false } },
        y:{ ticks:{ color:'#9fb8c9' }, grid:{ color:'rgba(255,255,255,0.03)' } }
      }
    }
  });
}
buildProjectChart();

/* =========================
   AI-style summary generator (template)
   ========================= */
function generateSummary(project){
  const tools = project.tools.join(', ');
  const short = project.description.length > 140 ? project.description.slice(0,137) + '...' : project.description;
  return `Project "${project.title}" — ${short} Tools: ${tools}. Outcome: mock score ${project.metrics.score}%. Dataset rows: ${project.dataset ? project.dataset.length : 0}. Focus: data cleaning, visualization, and stakeholder-facing insights.`;
}
document.getElementById('generateSummaries').addEventListener('click', ()=>{
  document.getElementById('aiSummary').value = PROFILE.projects.map(p=>generateSummary(p)).join("\n\n");
});

/* generate summary when view clicked also */
function makeSummaryForId(id){
  const p = PROFILE.projects.find(x=>x.id === id);
  if(!p) return '';
  return generateSummary(p);
}

/* =========================
   Download resume (html2pdf) with modern, clean design
   ========================= */
const downloadBtn = document.getElementById('downloadResumeBtn');
downloadBtn.addEventListener('click', async ()=>{
  const orig = downloadBtn.innerHTML;
  // show loader
  downloadBtn.innerHTML = `<span class="loader" aria-hidden="true"></span> Generating...`;
  downloadBtn.disabled = true;

  // create a modern, professional export node optimized for 8.5" x 11" (Letter size)
  const opt = {
    margin: [0.5,0.5,0.5,0.5],
    filename: `${PROFILE.name.replace(/\s+/g,'_')}_Resume_2024.pdf`,
    image: { type: 'jpeg', quality: 0.92 },
    html2canvas: { scale: 1, logging:false, useCORS:true, backgroundColor: '#ffffff' },
    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
  };
  
  const exportNode = document.createElement('div');
  exportNode.style.cssText = `
    background: #ffffff;
    color: #1a202c;
    padding: 20px;
    width: 7.5in;
    max-width: 7.5in;
    font-family: 'Arial', 'Helvetica', sans-serif;
    line-height: 1.4;
    box-sizing: border-box;
    font-size: 12px;
  `;
  
  exportNode.innerHTML = `
    <!-- PAGE 1: Header and Summary -->
    <div style="page-break-after: always; min-height: 9in;">
      <!-- Header Section -->
      <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #2563eb; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <img src="https://raw.githubusercontent.com/KMK-tech-v0/personal-webprofile/refs/heads/main/assets/profile-photo.jpg" alt="Kaung Myat Kyaw" style="width: 85px; height: 105px; border-radius: 8px; object-fit: cover; border: 2px solid #2563eb;" />
        <div style="flex: 1;">
          <h1 style="margin: 0; font-size: 1.9em; color: #1e293b; font-weight: bold;">${PROFILE.name}</h1>
          <p style="margin: 5px 0; font-size: 1.2em; color: #2563eb; font-weight: 600;">${PROFILE.title}</p>
          <div style="margin: 7px 0; color: #475569; font-size: 1em;">
            ${PROFILE.contact.email} | ${PROFILE.contact.phone} | ${PROFILE.contact.location}
          </div>
          <div style="margin: 5px 0; color: #64748b; font-size: 0.9em;">
            LinkedIn: linkedin.com/in/kaung-myat-kyaw | GitHub: KMK-tech-v0<br>
            Portfolio: kmk-tech-v0.github.io/personal-webprofile/
          </div>
        </div>
      </div>

      <!-- Professional Summary -->
      <div style="margin-bottom: 18px; padding: 12px; background: #f1f5f9; border-radius: 6px; border-left: 3px solid #1e40af; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Professional Summary</h2>
        <p style="margin: 0; color: #334155; font-size: 1.1em; line-height: 1.5;">
          Experienced professional with 9+ years across telecom data analysis, production management, sales, and office administration. Skilled at turning raw data into actionable insights and improving processes with modern analytics. Recognized for leadership, problem-solving, and adaptability.
        </p>
      </div>

      <!-- Core Competencies -->
      <div style="margin-bottom: 18px; padding: 12px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #0f766e; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Core Competencies</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; color: #374151; font-size: 1em;">
          <div>• Data Analysis & Visualization</div>
          <div>• SQL & Database Management</div>
          <div>• Python & R Programming</div>
          <div>• Power BI & Excel Reporting</div>
          <div>• Data Cleaning & Validation</div>
          <div>• Statistical Modeling</div>
          <div>• Process Optimization</div>
          <div>• Cross-functional Collaboration</div>
          <div>• Leadership & Training</div>
        </div>
      </div>

      <!-- Technical Skills -->
      <div style="margin-bottom: 18px; padding: 12px; background: #f1f5f9; border-radius: 6px; border-left: 3px solid #1d4ed8; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Technical Skills</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          ${PROFILE.technicalSkills.map(s => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; background: #e2e8f0; border-radius: 4px; border-left: 3px solid #1d4ed8; font-size: 1em;">
              <span style="font-weight: 600; color: #1e293b;">${s.name}</span>
              <span style="color: #1d4ed8; font-weight: bold;">${s.lvl}%</span>
            </div>
          `).join('')}
        </div>
      </div>

      <!-- Soft Skills -->
      <div style="margin-bottom: 18px; padding: 12px; background: #f0fdf4; border-radius: 6px; border-left: 3px solid #166534; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Soft Skills</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
          ${PROFILE.softSkills.map(s => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 10px; background: #dcfce7; border-radius: 4px; border-left: 3px solid #166534; font-size: 1em;">
              <span style="font-weight: 600; color: #1e293b;">${s.name}</span>
              <span style="color: #166534; font-weight: bold;">${s.lvl}%</span>
            </div>
          `).join('')}
        </div>
      </div>

      <!-- Professional Experience -->
      <div style="margin-bottom: 18px; padding: 12px; background: #fefefe; border-radius: 6px; border-left: 3px solid #7c3aed; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 12px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Professional Experience</h2>
        
        <div style="margin-bottom: 12px; padding: 10px; background: #f0f9ff; border-radius: 5px; border-left: 3px solid #0369a1; page-break-inside: avoid;">
          <h3 style="margin: 0 0 4px 0; color: #1e293b; font-size: 1.15em; font-weight: bold;">Data Analyst (Telecom — MPT cooperate)</h3>
          <p style="margin: 0 0 3px 0; color: #0369a1; font-weight: 600; font-size: 1em;">Myanmar Padauk Engineering & Construction Co., Ltd</p>
          <p style="margin: 0 0 5px 0; color: #64748b; font-style: italic; font-size: 0.95em;">Mar 2024 – Present · Yangon</p>
          <ul style="margin: 0; padding-left: 16px; color: #374151; font-size: 0.95em;">
            <li style="margin-bottom: 3px;">Gather and compile telecom data from network logs and usage records</li>
            <li style="margin-bottom: 3px;">Ensure data integrity via validation and quality checks; maintain databases</li>
            <li style="margin-bottom: 3px;">Analyze data to identify trends, patterns, and anomalies; produce actionable insights</li>
            <li style="margin-bottom: 3px;">Develop and maintain dashboards, reports, and visualizations</li>
          </ul>
        </div>
        
        <div style="margin-bottom: 12px; padding: 10px; background: #fef3c7; border-radius: 5px; border-left: 3px solid #d97706; page-break-inside: avoid;">
          <h3 style="margin: 0 0 4px 0; color: #1e293b; font-size: 1.15em; font-weight: bold;">Production Assistant Manager</h3>
          <p style="margin: 0 0 3px 0; color: #d97706; font-weight: 600; font-size: 1em;">Nilar Frozen Foods Co., Ltd</p>
          <p style="margin: 0 0 5px 0; color: #64748b; font-style: italic; font-size: 0.95em;">May 2021 – Feb 2024 · Nay Pyi Taw</p>
          <ul style="margin: 0; padding-left: 16px; color: #374151; font-size: 0.95em;">
            <li style="margin-bottom: 3px;">Implemented production schedules; coordinated resources for efficient processes</li>
            <li style="margin-bottom: 3px;">Monitored progress and adjusted plans to meet targets and shipment timelines</li>
            <li style="margin-bottom: 3px;">Maintained quality standards and safety compliance; led corrective actions</li>
          </ul>
        </div>
      </div>
      
      <!-- Additional Experience (Separate section to prevent page break issues) -->
      <div style="margin-bottom: 18px; padding: 12px; background: #f8fafc; border-radius: 6px; border-left: 3px solid #475569; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 12px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Additional Experience</h2>
        
        <div style="margin-bottom: 10px; padding: 10px; background: #f1f5f9; border-radius: 5px; border-left: 3px solid #6366f1; page-break-inside: avoid;">
          <h3 style="margin: 0 0 4px 0; color: #1e293b; font-size: 1.15em; font-weight: bold;">Personal Assistant</h3>
          <p style="margin: 0 0 3px 0; color: #6366f1; font-weight: 600; font-size: 1em;">Nilar Holding Co., Ltd</p>
          <p style="margin: 0 0 5px 0; color: #64748b; font-style: italic; font-size: 0.95em;">Sep 2019 – Nov 2021 · Yangon</p>
          <ul style="margin: 0; padding-left: 16px; color: #374151; font-size: 0.95em;">
            <li style="margin-bottom: 3px;">Managed executive schedules and travel; prepared reports and communications</li>
            <li style="margin-bottom: 3px;">Planned and coordinated events and meetings; handled logistics and budgeting</li>
          </ul>
        </div>
        
        <div style="padding: 8px; background: #f9fafb; border-radius: 4px; border-left: 3px solid #6b7280;">
          <h4 style="margin: 0 0 4px 0; color: #1e293b; font-size: 1.05em; font-weight: bold;">Other Positions</h4>
          <div style="font-size: 0.9em; color: #4b5563; line-height: 1.4;">
            • <strong>Sales & Marketing Supervisor</strong> — Myanmar Nilar Food Stuffs (Feb 2017 – Aug 2019)<br>
            • <strong>Warehouse Assistant</strong> — Pro-One Home Center (Dec 2015 – Oct 2016)<br>
            • <strong>Interviewer (Intern)</strong> — Neilsen MMRD (Jan 2016 – Apr 2016)<br>
            • <strong>Office Executive</strong> — ITN Company Limited (Jul 2014 – Oct 2015)
          </div>
        </div>
      </div>

      <!-- Education -->
      <div style="margin-bottom: 18px; padding: 12px; background: #fef2f2; border-radius: 6px; border-left: 3px solid #dc2626; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.3em; margin-bottom: 10px; padding-bottom: 4px; border-bottom: 1px solid #cbd5e1;">Education</h2>
        <div style="padding: 10px; background: #fee2e2; border-radius: 5px; border-left: 3px solid #dc2626;">
          <div style="margin-bottom: 8px; font-size: 1.05em;">
            <strong style="color: #1e293b;">B.A. History</strong> — Kyaukse University, Mandalay (June 2018)
          </div>
          <div style="margin-bottom: 8px; font-size: 1.05em;">
            <strong style="color: #1e293b;">Business in Marketing (IQN)</strong> — MIBA, Yangon (November 2018)
          </div>
          <div style="font-size: 1.05em;">
            <strong style="color: #1e293b;">Business in English (IQN)</strong> — MIBA, Yangon (Expected November 2024)
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE 2: Certifications, Training & Additional Info -->
    <div style="page-break-after: always; min-height: 9in;">
      <!-- Certifications & Training -->
      <div style="margin-bottom: 25px; padding: 15px; background: #f0fdfa; border-radius: 8px; border-left: 4px solid #059669; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.4em; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid #cbd5e1;">Certifications & Training</h2>
        <div style="padding: 12px; background: #d1fae5; border-radius: 6px; border-left: 3px solid #059669;">
          <ul style="margin: 0; padding-left: 18px; color: #374151; font-size: 1.05em;">
            <li style="margin-bottom: 6px;">Standard Operating Procedure (SOP) — Myanmar Nilar Food Stuff Co. Ltd</li>
            <li style="margin-bottom: 6px;">ISO 22000 — Nilar Frozen Foods Co. Ltd</li>
            <li style="margin-bottom: 6px;">HACCP — Nilar Frozen Foods Co. Ltd</li>
            <li style="margin-bottom: 6px;">Customer Service — Myanmar Nilar Food Stuff Co. Ltd</li>
            <li style="margin-bottom: 6px;">Leadership & Management — Myanmar Nilar Food Stuff Co. Ltd</li>
          </ul>
        </div>
      </div>
      
      <!-- Hobbies & Interests -->
      <div style="margin-bottom: 25px; padding: 15px; background: #faf5ff; border-radius: 8px; border-left: 4px solid #7c3aed; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.4em; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid #cbd5e1;">Hobbies & Interests</h2>
        <div style="padding: 12px; background: #ede9fe; border-radius: 6px; border-left: 3px solid #7c3aed;">
          <p style="margin: 0; color: #374151; font-size: 1.1em; line-height: 1.6;">
            Programming & Coding · Learning New Technologies · Photography · Puzzles & Logical Games
          </p>
        </div>
      </div>
      
      <!-- Personal Statement -->
      <div style="margin-bottom: 25px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #475569; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h2 style="color: #1e293b; font-size: 1.4em; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid #cbd5e1;">Personal Statement</h2>
        <div style="padding: 12px; background: #f1f5f9; border-radius: 6px; border-left: 3px solid #475569;">
          <p style="margin: 0; color: #374151; font-size: 1.1em; line-height: 1.6; font-style: italic;">
            "Transforming data into actionable insights for telecommunications excellence. Committed to continuous learning and delivering measurable results through analytical thinking and collaborative leadership."
          </p>
        </div>
      </div>
      
      <!-- Footer -->
      <div style="text-align: center; margin-top: 40px; padding: 20px; background: #f9fafb; border-radius: 8px; border-top: 3px solid #1e293b; color: #64748b; font-size: 1em;">
        <div style="margin-bottom: 8px; font-weight: 600; color: #1e293b;">Professional Resume</div>
        <div>Generated on ${new Date().toLocaleDateString()} | Kaung Myat Kyaw</div>
        <div style="margin-top: 5px; font-size: 0.9em;">Data Analyst · (Telecom, Manufacturing and Sales)</div>
      </div>
    </div>
  `;
  
  document.body.appendChild(exportNode);
  try{
    await html2pdf().from(exportNode).set(opt).save();
  }catch(err){
    console.error(err);
    alert('PDF export failed in this browser — try in Chrome/Edge.');
  }finally{
    document.body.removeChild(exportNode);
    downloadBtn.innerHTML = orig;
    downloadBtn.disabled = false;
  }
});



/* =========================
   Keyboard shortcuts
   g => generate summaries
   f => focus search
   ========================= */
document.addEventListener('keydown', e=>{
  if(e.key === 'g') document.getElementById('generateSummaries').click();
  if(e.key === 'f') { searchInput.focus(); searchInput.select(); }
});

/* =========================
   Small accessibility + performance tweaks
   Pause background on hidden
   ========================= */
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden){
    // pause wave loop by using lower framerate - simple approach: reduce particle velocities
    particles.forEach(p=> { p.vx *= 0.2; p.vy *= 0.2; });
  }else{
    particles.forEach(p=> { p.vx = (Math.random()-0.5)*0.4; p.vy = (Math.random()-0.5)*0.3; });
  }
});

/* =========================
   Helper functions
   ========================= */
function escapeHtml(str){
  return String(str)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
}

function loadImageWithFallback(img, srcList, opts = {}) {
  let idx = 0;
  let loaded = false;
  let timer = null;

  function tryLoad() {
    if (idx >= srcList.length) {
      if (opts.onFallback) opts.onFallback();
      return;
    }
    img.onerror = () => {
      idx++;
      setTimeout(tryLoad, opts.retryDelay || 500);
    };
    img.onload = () => {
      loaded = true;
      if (timer) clearTimeout(timer);
      if (opts.onSuccess) opts.onSuccess();
    };
    img.src = srcList[idx];
    if (opts.timeout) {
      timer = setTimeout(() => {
        if (!loaded) {
          idx++;
          tryLoad();
        }
      }, opts.timeout);
    }
  }
  tryLoad();
}

/* =========================
   Initial small UI effects to show content nicely
   ========================= */
setTimeout(()=> {
  document.querySelectorAll('.card').forEach((c, i)=> setTimeout(()=> c.classList.add('visible'), i*70));
}, 200);

/* Done! — All functionality present client-side.
   If anything misbehaves in your environment, open DevTools console for quick debugging.
*/
</script>
</body>
</html>




